/// NOTE: This schema is dedicated to the Usage module.
/// - Uses its own migrations directory: prisma/usage/migrations
/// - Points at USAGE_DATABASE_URL for its datasource.
/// - Generate/run Prisma commands with:
///     --schema=prisma/usage/schema.prisma
///     --migrations-dir=prisma/usage/migrations

generator usageClient {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
  output        = "../../.prisma/usage-client"
}

datasource usageDb {
  provider = "postgresql"
  url      = env("USAGE_DATABASE_URL")
}

model UsageModuleBootstrap {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
}

model UsageIntervalModule {
  id        String   @id @default(cuid())
  esiid     String
  meter     String
  ts        DateTime
  kwh       Decimal  @usageDb.Decimal(10, 5)
  filled    Boolean  @default(false)
  source    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([esiid, meter, ts])
  @@index([ts])
  @@index([esiid, meter, ts])
}

model RawGreenButton {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  homeId String?
  userId String?

  utilityName   String?
  accountNumber String?

  filename  String
  mimeType  String
  sizeBytes Int
  content   Bytes

  sha256     String?   @unique
  capturedAt DateTime?

  @@index([homeId])
  @@index([userId])
}

model GreenButtonInterval {
  id              String   @id @default(cuid())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  rawId           String
  homeId          String?
  userId          String?
  timestamp       DateTime
  consumptionKwh  Decimal  @usageDb.Decimal(10, 5)
  intervalMinutes Int      @default(15)

  @@index([rawId])
  @@index([timestamp])
  @@index([homeId, timestamp])
}
